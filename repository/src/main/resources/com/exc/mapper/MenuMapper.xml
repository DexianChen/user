<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.exc.mapper.MenuMapper" >
    <resultMap id="menuMap" type="com.exc.model.Menu" >
        <id column="user_id" property="userId" jdbcType="INTEGER" />
        <result column="account" property="account" jdbcType="VARCHAR" />
        <result column="pwd" property="pwd" jdbcType="VARCHAR" />
        <result column="real_name" property="realName" jdbcType="VARCHAR" />
        <result column="sex" property="sex" jdbcType="INTEGER" />
        <result column="id_card" property="idCard" jdbcType="VARCHAR" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="addressProvince" property="address_province" jdbcType="VARCHAR" />
        <result column="addressCity" property="address_city" jdbcType="VARCHAR" />
        <result column="addressArea" property="address_area" jdbcType="VARCHAR" />
        <result column="addressDetails" property="address_details" jdbcType="VARCHAR" />
        <result column="email" property="email" jdbcType="VARCHAR" />
        <result column="pictureUrl" property="picture_url" jdbcType="VARCHAR" />
        <result column="registered_time" property="registeredTime" jdbcType="TIMESTAMP" />
    </resultMap>

    <sql id="column" >
        user_id, account, pwd, real_name, sex, id_card, phone, address_province, address_city, address_area, address_details, email, picture_url, registered_time
    </sql>

    <select id="listMenu" parameterType="java.lang.String" resultMap="menuMap" >
        SELECT
        <include refid="column" />
        FROM TB_USER
        <where>
            <if test="searchParam != null">
                account LIKE CONCAT("%",#{searchParam},"%")
            </if>
        </where>
        <if test="fistIndex != null and perPage != null">
            LIMIT #{fistIndex}, #{perPage};
        </if>
    </select>

    <select id="countSize" parameterType="java.lang.String" resultType="java.lang.Integer" >
        SELECT COUNT(1) FROM TB_USER
        <where>
            <if test="searchParam != null">
                account LIKE CONCAT("%",#{searchParam},"%");
            </if>
        </where>
    </select>

    <insert id="insertUser" parameterType="com.exc.model.RequestParamVo">
        INSERT INTO TB_USER
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            NULL,
            <if test="account != null">
                #{account, jdbcType=VARCHAR},
            </if>
            <if test="pwd != null">
                #{pwd, jdbcType=VARCHAR},
            </if>
            <if test="realName != null">
                #{realName, jdbcType=VARCHAR},
            </if>
            <if test="sex != null">
                #{sex, jdbcType=INTEGER},
            </if>
            <if test="idCard != null">
                #{idCard, jdbcType=VARCHAR},
            </if>
            <if test="phone != null">
                #{phone, jdbcType=VARCHAR},
            </if>
            <if test="addressProvince != null">
                #{addressProvince, jdbcType=VARCHAR},
            </if>
            <if test="addressCity != null">
                #{addressCity, jdbcType=VARCHAR},
            </if>
            <if test="addressArea != null">
                #{addressArea, jdbcType=VARCHAR},
            </if>
            <if test="addressDetails != null">
                #{addressDetails, jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                #{email, jdbcType=VARCHAR},
            </if>
            <if test="pictureUrl != null">
                #{pictureUrl, jdbcType=VARCHAR},
            </if>
            NOW()
        </trim>
    </insert>

    <update id="updateUser"  parameterType="com.exc.model.RequestParamVo">
        UPDATE TB_USER
        <trim prefix="SET" suffixOverrides=",">
            <if test="pwd != null">
                pwd = #{pwd, jdbcType=VARCHAR},
            </if>
            <if test="realName != null">
                real_name = #{realName, jdbcType=VARCHAR},
            </if>
            <if test="sex != null">
                sex = #{sex, jdbcType=INTEGER},
            </if>
            <if test="idCard != null">
                id_card = #{idCard, jdbcType=VARCHAR},
            </if>
            <if test="phone != null">
                phone = #{phone, jdbcType=VARCHAR},
            </if>
            <if test="addressProvince != null">
                address_province = #{addressProvince, jdbcType=VARCHAR},
            </if>
            <if test="addressCity != null">
                address_city = #{addressCity, jdbcType=VARCHAR},
            </if>
            <if test="addressArea != null">
                address_area = #{addressArea, jdbcType=VARCHAR},
            </if>
            <if test="addressDetails != null">
                address_details = #{addressDetails, jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                email = #{email, jdbcType=VARCHAR},
            </if>
            <if test="pictureUrl != null">
                picture_url = #{pictureUrl, jdbcType=VARCHAR},
            </if>
        </trim>
        WHERE account = #{account};
    </update>

    <delete id="deleteUser" parameterType="java.lang.Integer">
        DELETE FROM TB_USER
        WHERE user_id IN
        <foreach collection="userIds" item="id" index="index" open="(" close=")" separator=",">
            #{id}
        </foreach>;
    </delete>

    <select id="findOne" parameterType="java.lang.Integer" resultMap="userMap">
        SELECT
        <include refid="column" />
        FROM TB_USER WHERE user_id = #{userId} LIMIT 1;
    </select>

    <delete id="deleteOne" parameterType="java.lang.Integer">
        DELETE FROM TB_USER
        WHERE user_id = #{userId};
    </delete>

    <select id="checkAccount" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM TB_USER WHERE account = #{account};
    </select>

    <select id="checkIdCard" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM TB_USER WHERE id_card = #{idCard};
    </select>

    <select id="checkPhone" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM TB_USER WHERE phone = #{phone};
    </select>

    <select id="checkEmail" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM TB_USER WHERE email = #{email};
    </select>
</mapper>